<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ElementsVR</title>
    <meta name="description" content="ElementsVR">
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-layout-component@4.2/dist/aframe-layout-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-curve-component/master/dist/aframe-curve-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="src/js/components/group-spheres.js"></script>
    <script src="src/js/components/element-box.js"></script>
    <script src="src/js/components/atom.js"></script>
    <script src="src/js/components/background-atom.js"></script>
    <script type="text/javascript">
      const elementData = {
        "group1": {"color": "red",
                    "name": "Alkalai Metals",
                    "elements": [
                      {number: "3", symbol:"Li", name:"Lithium", weight:"6.941"},
                      {number: "11", symbol:"Na", name:"Sodium", weight:"22.98976..."},
                      {number: "19", symbol:"K", name:"Potassium", weight:"39.948"},
                      {number: "37", symbol:"Rb", name:"Rubidium", weight:"85.4678"},
                      {number: "55", symbol:"Cs", name:"Caesium", weight:"132.9054"},
                      {number: "87", symbol:"Fr", name:"Francium", weight:"(223)"}
                  ]
                },
        "group2": {"color": "orange",
                  "name": "Alkaline Earth Metals",
                  "elements": [
                    {number: "4", symbol:"Be", name:"Beryllium", weight:"9.012182"},
                    {number: "12", symbol:"Mg", name:"Magnesium", weight:"24.305"},
                    {number: "20", symbol:"Ca", name:"Calcium", weight:"40.078"},
                    {number: "38", symbol:"Sr", name:"Strontium", weight:"87.62"},
                    {number: "54", symbol:"Ba", name:"Barium", weight:"132.9054"},
                    {number: "88", symbol:"Ra", name:"Radium", weight:"(226)"}
                  ]
                },
        "group3": {"color": "yellow",
                  "name": "Lanthanides",
                  "elements": [
                    {number: "57", symbol:"La", name:"Lanthanum", weight:"138.90547"},
                    {number: "58", symbol:"Ce", name:"Cerium", weight:"140.116"},
                    {number: "59", symbol:"Pr", name:"Praseodymium", weight:"140.90765"},
                    {number: "60", symbol:"Nd", name:"Neodymium", weight:"144.242"},
                    {number: "61", symbol:"Pm", name:"Promethium", weight:"(145)"},
                    {number: "62", symbol:"Sm", name:"Samarium", weight:"150.36"},
                    {number: "63", symbol:"Eu", name:"Europium", weight:"151.964"},
                    {number: "64", symbol:"Gd", name:"Gadolinium", weight:"157.25"},
                    {number: "65", symbol:"Tb", name:"Terbium", weight:"158.92535"},
                    {number: "66", symbol:"Dy", name:"Dysprosium", weight:"162.5"},
                    {number: "67", symbol:"Ho", name:"Holmium", weight:"164.93032"},
                    {number: "68", symbol:"Er", name:"Erbium", weight:"167.259"},
                    {number: "69", symbol:"Tm", name:"Thulium", weight:"168.93421"},
                    {number: "70", symbol:"Yb", name:"Ytterbium", weight:"173.054"},
                    {number: "71", symbol:"Lu", name:"Lutetium", weight:"174.9668"}
                  ]
                },
        "group4": {"color": "green",
                  "name": "Actinides",
                  "elements": [
                    {number: "89", symbol:"Ac", name:"Actinium", weight:"(227)"},
                    {number: "90", symbol:"Th", name:"Thorium", weight:"232.03806"},
                    {number: "91", symbol:"Pa", name:"Protactinium", weight:"231.0588"},
                    {number: "92", symbol:"U", name:"Uranium", weight:"238.02891"},
                    {number: "93", symbol:"Np", name:"Neptunium", weight:"(237)"},
                    {number: "94", symbol:"Pu", name:"Plutonium", weight:"(244)"},
                    {number: "95", symbol:"Am", name:"Americium", weight:"(243)"},
                    {number: "96", symbol:"Cm", name:"Curium", weight:"(247)"},
                    {number: "97", symbol:"Bk", name:"Berkelium", weight:"(247)"},
                    {number: "98", symbol:"Cf", name:"Californium", weight:"(251)"},
                    {number: "99", symbol:"Es", name:"Einstenium", weight:"(252)"},
                    {number: "100", symbol:"Fm", name:"Fermium", weight:"(257)"},
                    {number: "101", symbol:"Md", name:"Mendelevium", weight:"(258)"},
                    {number: "102", symbol:"No", name:"Nobelium", weight:"(259)"},
                    {number: "105", symbol:"Lr", name:"Lawrencium", weight:"(262)"}
                  ]
                },
        "group5": {"color": "blue",
                  "name": "Transition Metals",
                  "elements": [
                    {number: "21", symbol:"Sc", name:"Scandium", weight:"44.955912"},
                    {number: "22", symbol:"Ti", name:"Titanium", weight:"47.867"},
                    {number: "23", symbol:"V", name:"Vanadium", weight:"50.9415"},
                    {number: "24", symbol:"Cr", name:"Chromium", weight:"51.9961"},
                    {number: "25", symbol:"Mn", name:"Manganese", weight:"54.938045"},
                    {number: "26", symbol:"Fe", name:"Iron", weight:"55.845"},
                    {number: "27", symbol:"Co", name:"Cobalt", weight:"58.933195"},
                    {number: "28", symbol:"Ni", name:"Nickel", weight:"58.6934"},
                    {number: "29", symbol:"Cu", name:"Copper", weight:"63.546"},
                    {number: "30", symbol:"Zn", name:"Zinc", weight:"65.38"},
                    {number: "39", symbol:"Y", name:"Yttrium", weight:"88.90585"},
                    {number: "40", symbol:"Zr", name:"Zirconium", weight:"91.224"},
                    {number: "41", symbol:"Nb", name:"Niobium", weight:"92.90628"},
                    {number: "42", symbol:"Mo", name:"Molybdenum", weight:"95.96"},
                    {number: "43", symbol:"Tc", name:"Technetium", weight:"(98)"},
                    {number: "44", symbol:"Ru", name:"Ruthenium", weight:"101.07"},
                    {number: "45", symbol:"Rh", name:"Rhodium", weight:"102.9055"},
                    {number: "46", symbol:"Pd", name:"Palladium", weight:"106.42"},
                    {number: "47", symbol:"Ag", name:"Silver", weight:"107.8682"},
                    {number: "48", symbol:"Cd", name:"Cadmium", weight:"112.411"},
                    {number: "72", symbol:"Hf", name:"Hafnium", weight:"178.49"},
                    {number: "73", symbol:"Ta", name:"Tantalum", weight:"180.94788"},
                    {number: "74", symbol:"W", name:"Tungsten", weight:"183.84"},
                    {number: "75", symbol:"Re", name:"Rhenium", weight:"186.207"},
                    {number: "76", symbol:"Os", name:"Osmium", weight:"190.23"},
                    {number: "77", symbol:"Ir", name:"Iridium", weight:"192.217"},
                    {number: "78", symbol:"Pt", name:"Platinum", weight:"195.084"},
                    {number: "79", symbol:"Au", name:"Gold", weight:"196.966569"},
                    {number: "80", symbol:"Hg", name:"Mercury", weight:"200.59"},
                    {number: "104", symbol:"Rf", name:"Rutherfordium", weight:"(267)"},
                    {number: "105", symbol:"Db", name:"Dubnium", weight:"(268)"},
                    {number: "106", symbol:"Sg", name:"Seaborgium", weight:"(271)"},
                    {number: "107", symbol:"Bh", name:"Bohrium", weight:"(272)"},
                    {number: "108", symbol:"Hs", name:"Hassium", weight:"(270)"},
                    {number: "112", symbol:"Cn", name:"Copernicium", weight:"(285)"}
                  ]
                },
        "group6": {"color": "purple",
                  "name": "Post Transiton Metals",
                  "elements": [
                    {number: "13", symbol:"Al", name:"Aluminium", weight:"26.9815386"},
                    {number: "31", symbol:"Ga", name:"Gallium", weight:"69.723"},
                    {number: "49", symbol:"In", name:"Indium", weight:"114.818"},
                    {number: "50", symbol:"Sn", name:"Tin", weight:"118.71"},
                    {number: "81", symbol:"Tl", name:"Thallium", weight:"204.3833"},
                    {number: "82", symbol:"Pb", name:"Lead", weight:"207.2"},
                    {number: "83", symbol:"Bi", name:"Bismuth", weight:"208.9804"},
                    {number: "84", symbol:"Po", name:"Polonium", weight:"(209)"}
                  ]
                },
        "group7": {"color": "brown",
                  "name": "Metalloid",
                  "elements": [
                    {number: "5", symbol:"B", name:"Boron", weight:"10.811"},
                    {number: "14", symbol:"Si", name:"Silicon", weight:"28.0855"},
                    {number: "32", symbol:"Ge", name:"Germanium", weight:"72.63"},
                    {number: "33", symbol:"As", name:"Arsenic", weight:"74.9216"},
                    {number: "51", symbol:"Sb", name:"Antimony", weight:"121.76"},
                    {number: "52", symbol:"Te", name:"Tellurium", weight:"127.6"}
                  ]
                },
        "group8": {"color": "pink",
                  "name": "Non Metals",
                  "elements": [
                    {number: "1", symbol: "H", name:'Hydrogen', weight: "1.00794"},
                    {number: "6", symbol:"C", name:"Carbon", weight:"12.0107"},
                    {number: "7", symbol:"N", name:"Nitrogen", weight:"14.0067"},
                    {number: "8", symbol:"O", name:"Oxygen", weight:"15.9994"},
                    {number: "15", symbol:"P", name:"Phosphorus", weight:"30.973762"},
                    {number: "16", symbol:"S", name:"Sulfur", weight:"32.065"},
                    {number: "34", symbol:"Se", name:"Selenium", weight:"78.96"}
                  ]
                },
        "group9": {"color": "white",
                  "name": "Halogens",
                  "elements": [
                    {number: "9", symbol:"F", name:"Fluorine", weight:"18.9984032"},
                    {number: "17", symbol:"Cl", name:"Chlorine", weight:"35.453"},
                    {number: "35", symbol:"Br", name:"Bromine", weight:"79.904"},
                    {number: "53", symbol:"I", name:"Iodine", weight:"126.90447"},
                    {number: "85", symbol:"At", name:"Astatine", weight:"(210)"},
                  ]
                },
        "group10": {"color": "#1AFFF1",
                    "name": "Noble Gases",
                    "elements": [
                      {number: "2", symbol:"He", name:"Helium", weight:"4.002602"},
                      {number: "10", symbol:"Ne", name:"Neon", weight:"20.1797"},
                      {number: "18", symbol:"Ar", name:"Argon", weight:"39.948"},
                      {number: "36", symbol:"Kr", name:"Krypton", weight:"83.798"},
                      {number: "54", symbol:"Xe", name:"Xenon", weight:"131.293"},
                      {number: "86", symbol:"Rn", name:"Radon", weight:"(222)"},
                    ]
                  },
        "group11": {"color": "#FF07FE",
                    "name": "Unknown Properties",
                    "elements": [
                      {number: "109", symbol:"Mt", name:"Meitnerium", weight:"(276)"},
                      {number: "110", symbol:"Ds", name:"Darmstadium", weight:"(281)"},
                      {number: "111", symbol:"Rg", name:"Roentgenium", weight:"(280)"},
                      {number: "113", symbol:"Uut", name:"Unutrium", weight:"(284)"},
                      {number: "114", symbol:"Fl", name:"Flerovium", weight:"(289)"},
                      {number: "115", symbol:"Uup", name:"Ununpentium", weight:"(288)"},
                      {number: "116", symbol:"Lv", name:"Livermorium", weight:"(293)"},
                      {number: "117", symbol:"Uus", name:"Ununseptium", weight:"(294)"},
                      {number: "118", symbol:"Uuo", name:"Ununoctium", weight:"(294)"}
                    ]
                  }
      };

      function layoutDisplay(typeOfDisplay, id, position, radius) {
        let backgroundDisplay = document.createElement('a-entity');
        backgroundDisplay.id = id;
        backgroundDisplay.setAttribute('layout', {type: typeOfDisplay, radius: radius});
        backgroundDisplay.setAttribute('position', position);
        return backgroundDisplay;
      }

      function destroyEntities(parentEntity) {
        while (parentEntity.firstChild) {
          parentEntity.removeChild(parentEntity.firstChild);
        }
      }

      function clearGoogleInfo() {
        let googlePanel = document.getElementById('googlePanel');
        googlePanel.setAttribute('visible',false);
        destroyEntities(googlePanel);
      }

      function clearAtomScene() {
        document.getElementById('atom').parentNode.removeChild(atom.parentNode.firstChild);
        let curveContainer = document.getElementById('shell1').parentNode;
        let electronContainer = document.querySelectorAll('.electron')[0].parentNode;
        destroyEntities(curveContainer);
        destroyEntities(electronContainer);
      }

      function clearElementBoxScene() {
        let boxParentEntity = document.querySelector('a-box').parentNode;
        destroyEntities(boxParentEntity);
      }

      function returnToGroupSelection() {
        let periodicGroup = document.querySelector('a-sphere').className;

        // Clear the atom Scen
        clearAtomScene();

        // Reset the menu
        let guiMenu = document.getElementById('menuPanel');
        guiMenu.setAttribute('alongpath', {curve: '#menuTrack2'});
        guiMenu.setAttribute('animation__rotate', {property: 'rotation', dur: 1000, easing: "easeInSine", loop: false, to: {x:0, y:0, z:0}});

        //Hide the back button
        let backButton = document.getElementById('backMenuButton');
        backButton.setAttribute('visible',false);

        //Hide the googlePanel and clear the information
        clearGoogleInfo();

        let sceneEl = document.querySelector('a-scene');
        //if the mainScene Entity doesn't exist, create it.
        if (document.getElementById('boxMenu') === null) {
            sceneEl.appendChild(layoutDisplay("circle", "boxMenu", {x:0, y:0, z:-0.6}, 1));
        }
        renderBackground(sceneEl);

        for (let property in elementData) {
          if (elementData[property]["name"] === periodicGroup) {

            let color = elementData[property]["color"];
            let elementList = elementData[property]["elements"];

              for (element in elementList) {
                let elementBox = document.createElement('a-box');

                elementBox.setAttribute('element-box-info', {
                  color: color,
                  number: elementList[element]["number"],
                  symbol: elementList[element]["symbol"],
                  name: elementList[element]["name"],
                  weight: elementList[element]["weight"],
                  groupName: periodicGroup,
                });

                document.getElementById('boxMenu').appendChild(elementBox);
              }
          }
        }
      }

      function renderMainMenu() {
        let sceneEl = document.querySelector('a-scene');
        //Clear the scene of the atom
        if (document.getElementById('atom') !== null) {
          clearAtomScene();
        }

        // Destroy element boxes if they are present
        if (document.querySelector('a-box') !== null) {
          clearElementBoxScene();
        }

        //if the mainScene Entity doesn't exist, create it.
        if (document.getElementById('mainScene') === null) {
          sceneEl.appendChild(layoutDisplay("dodecahedron", "mainScene", {x:0, y:0, z:-0.5}, 4));
        }

        clearGoogleInfo();

        let menuContainer = document.getElementById('mainScene');
        for (let property in elementData) {
          let sphere = document.createElement('a-sphere');
          sphere.setAttribute('background-atom','');
          sphere.setAttribute('group-spheres',{color: elementData[property]["color"],
                                               groupName: elementData[property]["name"],
                                               elements: elementData[property]["elements"]});
          menuContainer.appendChild(sphere);
        }

        let menuGui = document.getElementById('menuPanel');
        menuGui.setAttribute('visible', false);

        //Hide the 'Back button'
        let backMenuButton = document.getElementById('backMenuButton');
        backMenuButton.setAttribute('visible', false);

        //Hide the google Panel
        let googlePanel = document.getElementById('googlePanel');
        googlePanel.setAttribute('visible',false);

        //Render the backGround if it is not present
        if (document.getElementById('background').children[0] === undefined) {
          renderBackground(sceneEl);
        }
      }

      function renderBackground(sceneEl) {
        if (document.getElementById('background') === null) {
          sceneEl.appendChild(layoutDisplay('dodecahedron', 'background', {x:0, y:0, z:0}, 15));
        }

        counter = 0;
        do {
          let backgroundAtom = document.createElement('a-sphere');
          backgroundAtom.className = 'backgroundAtom';
          backgroundAtom.setAttribute('background-atom','');
          document.getElementById('background').appendChild(backgroundAtom);
          counter = counter + 1;
        } while (counter < 20);
      }
    </script>
  </head>
  <body>
    <a-scene background="color: #ffffff">
      <a-assets>
         <img id="atom-image" src="https://ucarecdn.com/9cf7730a-5b3f-4335-8aef-1d25472c45f8/">
         <img id="github" src="https://ucarecdn.com/d3d87fb1-48cf-46ba-addc-38496f82f7c6/">
      </a-assets>

      <a-curve id="menuTrack">
        <a-curve-point position="0 -1 -5"></a-curve-point>
        <a-curve-point position="2.5 0 -5"></a-curve-point>
        <a-curve-point position="5 -1 -5"></a-curve-point>
      </a-curve>

      <a-curve id="menuTrack2">
        <a-curve-point position="5 -1 -5"></a-curve-point>
        <a-curve-point position="2.5 0 -5"></a-curve-point>
        <a-curve-point position="0 -1 -5"></a-curve-point>
      </a-curve>

      <!-- Credit Panel-->
      <a-plane id="creditPanel" color="#33ccff" height="3" width="4" position="0 -2.5 5" rotation="-45 180 0">
        <a-text value="Created by Daniel Rubio" position="0 1 0" align="center"></a-text>
        <a-image src="#github" position="-1 0.5 0" scale="0.5 0.5 0.5"></a-image>
        <a-text value="drubio1989" position="0 0.5 0" align="center"></a-text>
        <a-text value="Github Icon made by Dave Gandy from www.flaticon.com" position="0 -0.5 0" align="center"></a-text>
        <a-text value="Atom Icon made by Freepik from www.flaticon.com" position="0 -1 0" align="center"></a-text>
      </a-plane>

      <!--Google Info Panel-->
      <a-entity>
        <a-plane id="googlePanel" visible="false" height="5" width="5" position="-5 0 -3" rotation="0 45 0" color="#EF2D5E">
          <a-animation attribute="scale" from="0 1 1" to="1 1 1" dur="750" delay="500" fill="both"></a-animation>
        </a-plane>
      </a-entity>

      <!-- Dynamic Menu Panel -->
      <a-entity>
        <a-gui-flex-container id='menuPanel' visible="true" flex-direction="column" justify-content="center"
          align-items="center" component-padding="0.1" opacity="1"
          width="4" height="2" position="0 -1 -5" panel-color="#33ccff">
          <a-animation attribute="scale" from="0 1 1" to="1 1 1" dur="750" delay="500"
                         fill="backwards"></a-animation>
          <a-gui-label
           	width="4" height="3"
           	value="ElementsVR"
           	font-family="monospace"
            font-size="150px"
           	margin="1 0 0 0"
            font-color="#ffffff"
            background-color="#33ccff"
          >
            <a-image src="#atom-image" position="0 0.8 0"></a-image>
            <a-gui-button id="mainMenuButton" position="0 -1 0"
                   	width="2.5" height="0.75"
                   	onclick="renderMainMenu"
                   	value="Main Menu"
                    font-color="#ffffff"
                   	font-family="monospace"
                   	margin="0 0 0 0"
                    hover-color="#00cc66"
                   >
            </a-gui-button>
            <a-gui-button id="backMenuButton" position="0 -2 0"
                    visible="false"
                   	width="2.5" height="0.75"
                   	onclick="returnToGroupSelection"
                   	value="Back"
                    font-color="#ffffff"
                   	font-family="monospace"
                   	margin="0 0 0 0"
                    hover-color="#00cc66"
                   >
            </a-gui-button>
          </a-gui-label>
        </a-gui-flex-container>
      </a-entity>

      <!-- Camera -->
      <a-entity position="0 0 0" rotation="0 0 0">
        <a-camera>
          <a-cursor material="color: black;" fuse="true" fuseTimeOut="100"></a-cursor>
        </a-camera>
      </a-entity>
    </a-scene>
  </body>
  <script type="text/javascript">
    renderBackground(document.querySelector('a-scene'));
  </script>
</html>
